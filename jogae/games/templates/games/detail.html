{% extends 'base.html' %}
{% load static %}

{% block title %}Visualizar {{game.title}}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/games/detail.css'%}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
{% endblock %}

{% block content %}
<div class="detail-container">
    <div class="game-header">
        <div class="game-img-container">
            {% if game.picture %}
                <img src="{{game.picture.url}}" alt="{{ game.title }} cover" class="game-img">
            {% else %}
                <div class="no-photo"><p>Sem foto :(</p></div>
            {% endif %}
        </div>
        <div class="game-main-info">
            <h1>{{ game.title }}</h1>
            <p class="creator">Criador: <a href="{% url 'profile:profile' game.user.username %}">{{game.user.username}}</a></p>
            <p class="description">{{ game.description }}</p>
        </div>
    </div>

    <div class="game-meta">
        {% if game.genres.all %}
            <div class="genres">
                <h4>Gêneros</h4>
                {% for genre in game.genres.all %}<span class="badge">{{ genre.name }}</span>{% endfor %}
            </div>
        {% endif %}
        {% if game.tags.all %}
            <div class="tags">
                <h4>Tags</h4>
                {% for tag in game.tags.all %}<span class="badge">{{ tag.name }}</span>{% endfor %}
            </div>
        {% endif %}
    </div>

    <div class="reviews-section">
        <div class="reviews-header">
            <h3>Avaliações ({{ ratings.count }})</h3>
            <p class="rating">Média: <strong>{{ game.average_rating|floatformat:1 }} / 5.0</strong></p>
            <div class="sort-links">
                <a href="?orderby=recentes">Recentes</a> |
                <a href="?orderby=rating">Nota</a>
            </div>
        </div>
        
        <div class="reviews-list">
            {% for rating in ratings %}
            <div class="review-card">
                <div class="review-card-header">
                    <span class="review-rating">Nota: {{ rating.rating|floatformat:1 }} / 5.0</span>
                    <span class="review-meta">Por <a href="{% url 'profile:profile' rating.user.username %}">{{ rating.user.username }}</a> em {{ rating.created|date:"d M, Y" }}</span>
                </div>
                <div class="review-card-body"><p>{{ rating.body }}</p></div>
            </div>
            {% empty %}
                <p>Nenhuma avaliação ainda. Seja o primeiro!</p>
            {% endfor %}
        </div>
    </div>

    <div class="rating-form-section">
        <h3>Deixe sua Avaliação</h3>
        {% if user.is_authenticated %}
            <form method="post" class="rating-form">
                {% csrf_token %}
                <div class="form-group">
                    <label for="{{ rating_form.rating.id_for_label }}">Nota (0-5):</label>
                    {{ rating_form.rating }}
                </div>
                <div class="form-group">
                    <label for="{{ rating_form.body.id_for_label }}">Comentário:</label>
                    {{ rating_form.body }}
                </div>
                <button type="submit" class="btn-submit">Enviar Avaliação</button>
            </form>
        {% else %}
            <p><a class="login-link" href="{% url 'auth:login' %}?next={{ request.path }}">Faça login</a> para deixar uma avaliação.</p>
        {% endif %}
    </div>

    <a class="back-link" href="{% url 'home' %}">
        <i class="fa-solid fa-chevron-left"></i> Voltar para jogos
    </a>
</div>
{% endblock %}